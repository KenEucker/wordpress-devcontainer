#!/bin/bash
sourceFolder='src'
themeFolder="$sourceFolder/theme"
pluginFolder="$sourceFolder/plugin"
nodeModulesFolder="node_modules"
themeGulpModule="./node_modules/.bin/gulp"

chmod -R 777 $sourceFolder

if [ ! "$(ls -A $sourceFolder)" ]; then
	node pull.js "$@" -y
fi

if [ "$(ls -A $themeFolder)" ]; then

	cd $themeFolder

	if [ ! -d "$nodeModulesFolder" ]; then
		npm install
	fi

	cd ../..

	if [ ! -d "$themeFolder/gulpfile.js" ]; then
		$themeGulpModule -f $themeFolder/gulpfile.js compile
	fi
fi

if [ "$(ls -A $pluginFolder)" ]; then

	cd $pluginFolder

	if [ ! -d "$nodeModulesFolder" ]; then
		npm install
	fi

	cd ../..

	if [ ! -d "$pluginFolder/gulpfile.js" ]; then
		$themeGulpModule -f $pluginFolder/gulpfile.js compile
	fi
fi
