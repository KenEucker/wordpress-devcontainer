#!/bin/bash
sourceFolder='src'
themeFolder="$sourceFolder/theme"
pluginFolder="$sourceFolder/plugin"
nodeModulesFolder="node_modules"
themeGulpModule="./node_modules/.bin/gulp"

chmod -R 777 $sourceFolder

if [ ! "$(ls $sourceFolder) -A" ]; then
	node pull.js "$@" -y
fi

if [ "$(ls $themeFolder) -A" ]; then

	cd $themeFolder

	if [ ! -d "$nodeModulesFolder" ]; then
		npm install
	fi

	cd ../..

	if [ ! -d "$themeFolder/gulpfile.js" ]; then
		$themeGulpModule -f $themeFolder/gulpfile.babel.js dist
	fi
fi

if [ "$(ls -A $pluginFolder)" ]; then

	cd $pluginFolder

	if [ ! -d "$nodeModulesFolder" ]; then
		npm install
	fi

	cd ../..

	if [ ! -d "$pluginFolder/gulpfile.js" ]; then
		$themeGulpModule -f $pluginFolder/gulpfile.babel.js dist
	fi
fi
